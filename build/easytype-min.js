(function(){function t(a,b){function c(){var b=0;$.each(arguments,function(c,d){var e=typeof d==="string"?parseFloat((d.match(/px$/)?d:a.css(d)).replace(/px$/,"")):d;b+=e});return b+"px"}var d=$("<div/>").css({display:a.css("display"),position:"relative"}),e=a.css("background-color"),f=c("padding-left"),g=c("padding-right"),i=c("padding-top"),n=c("padding-bottom"),h=c(a.height(),"border-top-width","border-top-width"),j=c(a.width(),"border-left-width","border-right-width");a.wrap(d);d=a.parent();d.css("background-color",
e);$.each("margin-left,margin-top,margin-left,margin-right,background-color,border-left-style,border-right-style,border-top-style,border-bottom-style,border-left-width,border-right-width,border-top-width,border-bottom-width,border-left-color,border-right-color,border-top-color,border-bottom-color,line-height,font-size".split(","),function(b,c){d.css(c,a.css(c))});d.css("padding-left",f);d.css("padding-right",g);d.css("padding-top",i);d.css("padding-bottom",n);d.height(h).width(j);a.css({"background-color":"transparent",
position:"relative","ime-mode":"disabled",margin:"0px","border-width":"0px","border-style":"none",padding:0});e=function(a){var b;do if((b=a.css("z-index"))!=="auto")return parseInt(b);while((a=a.parent()).length!=0&&a[0].tagName!="HTML");return 0}(a);e==0?a.css("z-index",1):e--;b.ui_measure=(b.ui_prompt=$("<div></div>").css({"font-size":a.css("font-size"),"font-family":a.css("font-family"),position:"absolute",left:"0px",top:"0px",bottom:"0px","z-index":e,"padding-top":i,"padding-left":f,"padding-right":g,
"padding-bottom":n}).appendTo(d)).clone().css({visibility:"hidden",padding:"0px"}).appendTo(d);b.ui_prompt.addClass(b.settings.css_prompt);b.settings.deluxe&&u(b,e)}function u(a,b){a.ui_renderingComponent=a.ui_prompt.clone().insertBefore(a.ui_prompt).addClass(a.settings.css_input_text).removeClass(a.settings.css_prompt);a.ui_measure.addClass(a.settings.css_input_text);a.ui_caretBlink=$("<div></div>").css({position:"absolute",width:"1px",height:a.$element.height(),top:a.ui_prompt.css("padding-top"),
"z-index":b+2,"background-color":"#000000",visibility:"hidden"}).insertBefore(a.ui_renderingComponent);a.$element.css("color","transparent");a.caretBlinkLeftPatch=parseInt(a.ui_prompt.css("padding-left").replace(/px$/,""))}function v(a,b){$.each(["keypress","keydown","focus","blur","paste"],function(b,d){a.bind(d,l[d])});a.attr("autocomplete","off");b.settings.deluxe&&($.each(["focus","blur"],function(b,d){a.bind(d,l[d+"Extra"])}),a.bind("click",l.click));a.parent().bind("click",l.divClick)}function o(a){var b=
document.createElement("div"),a=document.createTextNode(a);b.appendChild(a);return b.innerHTML.replace(/ /g,"&nbsp;")}function p(a,b){this.$element=a;this.settings=b;this.template=null;this.templateFragments=[];this.promptLayer=null;this.inputCache=[];this._caretMonitorHandler=this._cutMonitorHandler=this._pasteMonitorHandler=null;this.mutex1=this._caretBlinkStatus=false;this.ui_caretBlink=this.ui_renderingComponent=this.ui_measure=this.ui_prompt=null;this.caretBlinkLeftPatch=0;this.fontStyleString=
this.computeFontStyleString()}function m(a,b,c){this.order=a;this.type=b;this.value=c;this.templateFragment=null;this.orderInFragment=0}function h(a,b){m.call(this,a,"L",b)}function j(a,b,c){m.call(this,a,b,c)}function q(a){this.order=a;this.characters=[];this.entries=[];this.previous=this.next=null}var r={D:"#",T:"$"},k={D:[{keyCodeStart:48,keyCodeEnd:57}],T:[{keyCodeStart:48,keyCodeEnd:57},{keyCodeStart:97,keyCodeEnd:122},{keyCodeStart:65,keyCodeEnd:90}],LEFT:37,RIGHT:39,END:35,HOME:36,DELETE:46,
BACKSPACE:8,TAB:9},s=[];(function(a){var b={init:function(b){var d={css_prompt:"easytype_prompt",css_entry_label:"easytype_label",css_entry_mask:"easytype_mask",css_input_text:"easytype_input_text",deluxe:false,pattern:""};typeof b==="object"?a.extend(d,b):typeof b==="string"&&a.extend(d,{pattern:b});return this.each(function(){var b=a(this),c=new p(b,d);s.push(c);b.data("autoformat",c);c.applyPattern(d.pattern);t(b,c);v(b,c)})},destroy:function(){return this.each(function(){a(this)})},cache:function(){return s}};
a.fn.easytype=function(c){if(b[c])return b[c].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof c==="object"||typeof c==="string"||!c)return b.init.apply(this,arguments);else a.error("Method "+c+" does not exist on jQuery.Easytype")}})(jQuery);var l={keypress:function(a){var b=$(this).data("autoformat");if(b)b.mutex?b.mutex=false:(b.handleTyping(a),a.preventDefault())},keydown:function(a){var b=$(this).data("autoformat");b&&b.handleControlKey(a)},preventDefault:function(a){a.preventDefault();
return false},focus:function(){var a=$(this).data("autoformat");a&&a.showPrompt()},focusExtra:function(){var a=$(this).data("autoformat");a&&a.activateCaret()},blur:function(){var a=$(this).data("autoformat");a&&a.hidePrompt()},blurExtra:function(){var a=$(this).data("autoformat");a&&a.deactivateCaret()},paste:function(){var a=$(this).data("autoformat");if(a){var b=a.getSelection();a._pasteMonitorHandler=window.setInterval(function(){var c=0;return function(){var d=a.checkCacheTempered(b);d!=false&&
(window.clearInterval(a._pasteMonitorHandler),a.handlePaste(d,b));c++;c>=10&&window.clearInterval(a._pasteMonitorHandler)}}(),10)}},click:function(){var a=$(this).data("autoformat");a&&a.activateCaret()},divClick:function(){$(this).find("input").focus()}};$.extend(p.prototype,{getCaretPosition:function(){return this.getSelection().caret},getSelection:function(){var a=this.$element[0],b=-1,c;if(a.selectionStart>=0)b=a.selectionStart,c=a.selectionEnd-a.selectionStart;else if(document.selection)a.tagName&&
a.tagName==="TEXTAREA"?(c=document.selection.createRange().duplicate(),a=a.createTextRange(),a.collapse(false),a.moveToBookmark(c.getBookmark()),c.text===""&&(b=a.duplicate(),b.moveEnd("character",1),c.boundingWidth===b.boundingWidth&&c.boundingHeight===b.boundingHeight&&(a=b))):a=document.selection.createRange().duplicate(),c=a.text.length,b=Math.abs(a.moveStart("character",-1E6));else if(document.getSelection)b=0,c=document.getSelection().length;return{caret:b,length:c}},setCaretPosition:function(a){var b=
this.$element[0];b.setSelectionRange?(b.focus(),b.setSelectionRange(a,a)):b.createTextRange&&(b=b.createTextRange(),b.collapse(true),b.moveEnd("character",a),b.moveStart("character",a),b.select());this.settings.deluxe&&this.activateCaret(a)},applyPattern:function(a){this.template=this.interpretRule(a);this.buildTemplateFragmentList()},interpretRule:function(a){for(var b=0,c=0,d=[];b<a.length;){var e=a.charAt(b);e=="\\"?(e=a.charAt(++b),e=="$"||e=="#"?d.push(new h(c++,e)):b--):e=="$"?d.push(new j(c++,
"T",e)):e=="#"?d.push(new j(c++,"D",e)):d.push(new h(c++,e));b++}return d},buildTemplateFragmentList:function(){for(var a=0,b=this.template.length,c=null,d=0;d<b;d++){var e=d,f=d,g=0,i=this.template[d];if(i.type=="L"){for(;f<b;f++)if(i=this.template[f],i.type!="L"){f--;break}d=f==b?--f:f}var h=new q(a++);if(h.previous=c)c.next=h;this.templateFragments.push(h);for(c=h;e<=f;)i=this.template[e++],i.fragmentOrder=g++,i.templateFragment=h,h.addEntry(i)}},getTemplateEntry:function(a){var b=this.template.length;
return a>=b?{type:"EOF",order:b}:this.template[a]},handleTyping:function(a){var b=this.getCaretPosition(),c=this.getTemplateEntry(b);c.type!="EOF"&&c.inputChecking(this,b,a)},handleControlKey:function(a){this.testCombinationKey(a)?this.mutex=true:this.handleFunctionalKey(a)?(this.mutex=true,a.preventDefault()):this.mutex=false},testCombinationKey:function(a){var b=a.which||a.keyCode;return a.ctrlKey&&b==88?(this.handleCut(a),true):a.ctrlKey&&(b==65||b==67||b==86)||a.shiftKey&&(b==k.LEFT||b==k.RIGHT)||
b==k.TAB},handleFunctionalKey:function(a){for(var b=a.which||a.keyCode,c=this.getCaretPosition(),d=[["LEFT","handleLeftMovement"],["RIGHT","handleRightMovement"],["DELETE","handleDelete"],["BACKSPACE","handleBackspace"]],e=0;e<d.length;e++){var f=d[e];if(b==k[f[0]])return this[f[1]](a,c),true}return false},handleLeftMovement:function(a,b){var c=this.getTemplateEntry(b);if(c.type=="EOF")c=this.templateFragments[this.templateFragments.length-1];else if(c=c.templateFragment,c.previous)c=c.previous;b=
c.entries[0].order;this.setCaretPosition(b);return b},handleRightMovement:function(a,b){var c=this.getTemplateEntry(b),b=(c.type=="EOF"?this.templateFragments[this.templateFragments.length-1]:c.templateFragment).getLastEntry().order+1;this.setCaretPosition(b);return b},handleDelete:function(a,b){var c=true,d=this.getSelection();if(d.length!=0)return this.groupSelectionRemove(d);var d=this.getTemplateEntry(b),e;if(d.type=="L")c=false,e=d.templateFragment,e.next==null?b=e.entries[0].order:(e=e.next,
e=e.entries[0].order,b=this.inputCache[e]!=void 0||d.fragmentOrder!=0?e:d.templateFragment.entries[0].order);d=this.buildActiveInputQueueAtCaret(b);d.shift();this.fillActiveInputIntoTemplate(b,d,c);this.displayCache();this.setCaretPosition(b);return true},handleBackspace:function(a,b){var c=this.getSelection();if(c.length!=0)return this.groupSelectionRemove(c);if(--b<0)return true;c=this.getTemplateEntry(b);if(c.type=="L")if(c=c.templateFragment,c.order==0){if(this.inputCache[b+1]!==void 0){this.setCaretPosition(0);
return}b=0}else c=c.previous,b=c.entries[0].order;c=this.buildActiveInputQueueAtCaret(b);c.shift();this.fillActiveInputIntoTemplate(b,c,false);this.displayCache();this.setCaretPosition(b);return true},handlePaste:function(a,b){var c=this.buildActiveInputQueueAtCaret(a.start),d=0;for(b.length!=0&&(d=this.inputMaskStatisticWithinRange(b.caret,b.length));d--;)c.shift();for(var d=[],e=0;e<a.diff.length;e++)d.push({type:"I",value:a.diff[e]});c=d.concat(c);this.fillActiveInputIntoTemplate(a.start,c);this.displayCache();
this.setCaretPosition(a.start);return true},handleCut:function(){var a=this.getSelection();if(a.length!=0)this._valueBeforeCut=this.$element.val(),this.groupSelectionRemove(a,false),this._cutMonitorHandler=window.setInterval(function(b){var c=0;return function(){if(b.$element.val()!=b._valueBeforeCut)b._valueBeforeCut=null,window.clearInterval(b._cutMonitorHandler),b.displayCache(),b.setCaretPosition(a.caret);c++;c>=10&&window.clearInterval(b._cutMonitorHandler)}}(this),10)},prefill:function(a){var b=
this.getTemplateEntry(a);if(b.type=="L")for(var c=b.templateFragment.getLastEntry().order;a<=c;)b=this.template[a],this.inputCache[a++]={type:"L",value:b.value}},insertInputEntry:function(a,b){var c=this.buildActiveInputQueueAtCaret(a);c.splice(0,0,b);this.prefill(this.fillActiveInputIntoTemplate(a,c))},buildActiveInputQueueAtCaret:function(a){for(var b=[],c=this.inputCache.length;a<c;){var d=this.inputCache[a++];d.type=="I"&&b.push(d)}return b},fillActiveInputIntoTemplate:function(a,b,c){c===void 0&&
(c=true);var d,e,f,g=this.getTemplateEntry(a);for(b.length==0&&g.type=="L"&&g.fragmentOrder!=0&&(a=g.templateFragment.getLastEntry().order+1);b.length;){g=this.getTemplateEntry(a);if(g.type=="EOF")break;if(g.type!="L")e=b.shift(),g.matchCharacter(e.value)&&(this.inputCache[a++]=e);else if(g.type=="L"){d=g.templateFragment;var i=d.entries.length;for(f=g.fragmentOrder;f<i;f++)g=d.entries[f],this.inputCache[a++]={type:"L",value:g.value},e=b[0],g.matchCharacter(e.value)&&b.shift()}}g=this.getTemplateEntry(a);
c&&g instanceof h&&g.fragmentOrder===0&&this.inputCache[a]!==void 0&&(a=g.templateFragment.getLastEntry().order+1);this.inputCache.splice(a,this.inputCache.length);return a},groupSelectionRemove:function(a,b){b==void 0&&(b=true);for(var c=a.caret,d=this.buildActiveInputQueueAtCaret(c),e=this.inputMaskStatisticWithinRange(c,a.length);e--;)d.shift();this.fillActiveInputIntoTemplate(c,d,c!=0);b&&(this.displayCache(),this.setCaretPosition(c));return true},inputMaskStatisticWithinRange:function(a,b){for(var c=
0,d=a,e=0,f=this.inputCache.length;d<f&&e<b;d++)this.inputCache[d].type!="L"&&c++,e++;return c},checkCacheTempered:function(a){var b=this.$element.val(),c=b.length,d=this.inputCache.length,e=this.calculateCachePresentation();d-=a.length;if(b==e)return false;a=c-d;c=this.getCaretPosition();a>0?(c-=a,b=b.substr(c,a)):b=this.calculateCachePresentation().substr(c,-a);return{diff:b,start:c,length:a}},computeFontStyleString:function(){var a=this.$element,b="";$.each(["font-size","font-family","font-weight",
"line-height"],function(c,d){b+=d+":"+a.css(d)+" !important; "});return b},displayCache:function(){this.$element.val(this.calculateCachePresentation());this.settings.deluxe&&(this.ui_renderingComponent.html(this.calculateCacheDeluxePresentation()),this.normalizeFont(this.ui_renderingComponent));this.updatePatternPrompt()},calculateCachePresentation:function(){for(var a="",b=0,c=this.inputCache.length;b<c;b++)a+=this.inputCache[b].value;return a},calculateCacheDeluxePresentation:function(a){if(a===
void 0)a=this.inputCache.length;return this.constructEntriesPresentation(this.inputCache,0,a)},updatePatternPrompt:function(){var a=this.$element.val(),b;b=this.settings.deluxe?this.calculateCacheDeluxePresentation():o(a);a=this.constructEntriesPresentation(this.template,a.length,this.template.length);this.ui_prompt.css("left",this.measureTextWidth(b)+"px");this.ui_prompt.html(a);this.normalizeFont(this.ui_prompt)},constructEntriesPresentation:function(a,b,c){for(var d="";b<c;b++){var e=a[b],f=this.settings.css_entry_mask;
e.type=="L"?(e=o(e.value),f=this.settings.css_entry_label):e=r[e.type]||e.value;d+='<span class="'+f+'">'+e+"</span>"}return d},normalizeFont:function(a){a.find("span").attr("style",this.fontStyleString)},measureTextWidth:function(a){this.ui_measure.html(a);this.normalizeFont(this.ui_measure);return this.ui_measure.width()},showPrompt:function(){this.ui_prompt.show();this.updatePatternPrompt()},hidePrompt:function(){this.ui_prompt.hide()},activateCaret:function(a){this.deactivateCaret();this.updateBlinkPosition(a);
a=function(a){return function(){a._caretBlinkStatus=!a._caretBlinkStatus;a.ui_caretBlink.css("visibility",a._caretBlinkStatus?"visible":"hidden")}}(this);this._caretMonitorHandler=window.setInterval(a,500);a()},deactivateCaret:function(){if(this._caretMonitorHandler!=null)window.clearInterval(this._caretMonitorHandler),this.ui_caretBlink.css("visibility","hidden"),this._caretBlinkStatus=false},updateBlinkPosition:function(a){a===void 0&&(a=this.getCaretPosition());this.ui_caretBlink.css("left",this.caretBlinkLeftPatch+
this.measureTextWidth(this.calculateCacheDeluxePresentation(a))+"px")}});h.prototype=new m;h.prototype.constructor=h;$.extend(h.prototype,{matchKey:function(a){return this.matchCharacter(String.fromCharCode(a.which||a.keyCode))},matchCharacter:function(a){return a.toUpperCase()==this.value.toUpperCase()},inputChecking:function(a,b,c){var d=false;if(this.matchKey(c))this.fragmentOrder==0&&a.prefill(b),b++,d=true;else{var e=this.templateFragment.getLastEntry().order+1,f=a.getTemplateEntry(e);f.type==
"EOF"?(a.prefill(b),b=e,d=true):(c=f.matchKey(c),c.match&&(this.fragmentOrder==0&&a.prefill(b),a.insertInputEntry(e,{type:"I",value:c.character}),b=e+1,d=true))}return d?(a.displayCache(),a.setCaretPosition(b),true):false}});j.prototype=new m;$.extend(j.prototype,{constructor:j,matchKey:function(a,b){var c=k[this.type],d={match:false,character:null};b==void 0&&(b=a.which||a.keyCode);for(var e=null,f=0,g=c.length;f<g;f++)if(e=c[f],b>=e.keyCodeStart&&b<=e.keyCodeEnd){d.match=true;d.character=String.fromCharCode(b);
break}return d},matchCharacter:function(a){return this.matchKey(null,a.charCodeAt(0)).match},inputChecking:function(a,b,c){if(c.altKey||c.ctrlKey||c.metaKey)return false;if(this.type!="D"&&this.type!="T")return false;c=this.matchKey(c);if(!c.match)return false;a.insertInputEntry(this.order,{type:"I",value:c.character});a.displayCache();a.setCaretPosition(b+1);return true}});$.extend(q.prototype,{addEntry:function(a){this.characters.push(a.type=="L"?a.value:r[a.type]);this.entries.push(a)},getLastEntry:function(){return this.entries[this.entries.length-
1]}})})();
